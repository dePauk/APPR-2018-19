---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Darjan Pavšič""
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny  #to izbriši
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

## Igralci tedna in uspešnost njihovih ekip v ligi NBA

V projektu bom analiziral igralce tedna ("Player of the Week") lige NBA v sezonah od 1984/85 do 2017/18. Poskušal bom ugotoviti, kako močna je korelacija med številom osvojenih nazivov igralca tedna posamezne ekipe in številom oziroma odstotkom dobljenih tekem teh ekip v istem obdobju. Poleg tega bom igralce, ki so bili izbrani kot najboljši v tednu, primerjal po poziciji igranja, starosti, višini, teži, številu let od debija v ligi ter po tem, katera je bila njihova pozicija na t.i. draftu. V letih, ko je bil naslov igralca tedna dodeljen le enemu igralcu, in ne po enemu igralcu iz posamezne konference, bom analiziral, katera konferenca je bila uspešnejša v številu teh nazivov in rezultat primerjal z uspešnostjo njihovih ekip v zaključni fazi tekmovanja.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozil sem podatke o igralcih tedna in sezonski statistiki igralcev v izbranih sezonah v obliki CSV s spletne strani Kaggle ter statistiko NBA ekip v tem obdobju s spletne strani mcubed.net in all-star igralce iz Wikipedije v obliki HTML. Podatki so v razpredelnicah v obliki *tidy data*.


1. podatki_ekipe_imensko

  - `Ekipa` - imena ekip, urejena po abecednem vrstnem redu
  - `Zmage_redni_del` - spremenljivka: število zmag ekipe v izbranem obdobju
  - `Porazi_redni_del` - spremenljivka: število porazov ekipe v izbranem obdobju
  - `Uspesnost_redni_del` - spremenljivka: delež zmaganih tekem v rednem delu
  - `Stevilo_playoffov` - spremenljivka: število uvrstitev v končnico oziroma "Play-off"
  - `Playoff_zmage` - spremenljivka: število zmag v Play-offih
  - `Playoff_porazi` - spremenljivka: število porazov v Play-offih
  - `Zmage_serij` - spremenljivka: število premaganih nasprotnikov v Play-offih (uvrstitev v naslednji krog končnice)
  - `Porazi_serij` - spremenljivka: število izgubljenih serij (izpadov iz končnice)
  - `Uspesnost_serij` - spremenljivka: delež zmaganih serij
  - `Nastopi_finale` - spremenljivka: število nastopov v finalih (zmag svoje konference)
  - `Zmage_finale` - spremenljivka: število osvojenih nazivov zmagovalca lige
  

2. igralci_tedna

  - `Starost` - meritev: starost igralca
  - `Konferenca` - spremenljivka: vzhod/zahod
  - `Leto_drafta` - spremenljivka: leto, v katerem je bil igralec draftan v ligo
  - `Visina` - meritev: višina igralca
  - `Ime` - spremenljivka: ime igralca
  - `Pozicija` - spremenljivka: pozicija igranja
  - `Sezona okrajsano` - spremenljivka: za npr. sezono 1991/92 bo tukaj vrednost 1992
  - `Stevilo_sezon_v_ligi` - meritev: število odigranih sezon pred začetkom trenutne (v tej sezoni draftani igralci imajo torej vrednost 0)
  - `Igralceva_ekipa` - spremenljivka: ekipa, v kateri igra
  - `Teza` - meritev: teža igralca
  - `Vrednost_naziva` - spremenljivka: 0.5 za sezone, kjer se naziv dodeli po enemu igralcu iz vsake konference oz. 1 za sezone, kjer se naziv dodeli enemu igralcu iz celotne lige


3. stevilo_nazivov

  - `Ekipa` - imena ekip, urejena po vrstnem redu
  - `Stevilo` - število dobljenih nazivov igralca tedna ekipe
  

4. statistika

  -

5. tabela_allstar

  -






Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
